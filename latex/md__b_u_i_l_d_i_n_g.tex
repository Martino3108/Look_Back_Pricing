\chapter{Building and Distributing Look\+Back Dynamic Library (mac\+OS) }
\hypertarget{md__b_u_i_l_d_i_n_g}{}\label{md__b_u_i_l_d_i_n_g}\index{Building and Distributing LookBack Dynamic Library (macOS)@{Building and Distributing LookBack Dynamic Library (macOS)}}
\label{md__b_u_i_l_d_i_n_g_autotoc_md0}%
\Hypertarget{md__b_u_i_l_d_i_n_g_autotoc_md0}%


This document describes how to {\bfseries{build}}, {\bfseries{install}}, and {\bfseries{distribute}} the {\ttfamily lib\+Look\+Back.\+dylib} dynamic library on mac\+OS, with special attention to {\bfseries{Microsoft Excel sandboxing}} and {\bfseries{distribution (codesigning + notarization)}}.

\DoxyHorRuler{0}
\hypertarget{md__b_u_i_l_d_i_n_g_autotoc_md2}{}\doxysection{\texorpdfstring{1. Requirements}{1. Requirements}}\label{md__b_u_i_l_d_i_n_g_autotoc_md2}
\hypertarget{md__b_u_i_l_d_i_n_g_autotoc_md3}{}\doxysubsection{\texorpdfstring{System}{System}}\label{md__b_u_i_l_d_i_n_g_autotoc_md3}

\begin{DoxyItemize}
\item mac\+OS 13+
\item Xcode Command Line Tools
\item clang++
\end{DoxyItemize}\hypertarget{md__b_u_i_l_d_i_n_g_autotoc_md4}{}\doxysubsection{\texorpdfstring{Dependencies}{Dependencies}}\label{md__b_u_i_l_d_i_n_g_autotoc_md4}

\begin{DoxyItemize}
\item Homebrew
\item Open\+MP ({\ttfamily libomp})
\end{DoxyItemize}

Install Open\+MP via Homebrew:\+ 
\begin{DoxyCode}{0}
\DoxyCodeLine{brew\ install\ libomp}

\end{DoxyCode}
\hypertarget{md__b_u_i_l_d_i_n_g_autotoc_md5}{}\doxysection{\texorpdfstring{2. Building the Dynamic Library}{2. Building the Dynamic Library}}\label{md__b_u_i_l_d_i_n_g_autotoc_md5}
The library is built as a mac\+OS .dylib using clang++ in C++20 mode, with optimizations enabled and Open\+MP support.\hypertarget{md__b_u_i_l_d_i_n_g_autotoc_md6}{}\doxysubsection{\texorpdfstring{Build command}{Build command}}\label{md__b_u_i_l_d_i_n_g_autotoc_md6}

\begin{DoxyCode}{0}
\DoxyCodeLine{clang++\ -\/std=c++20\ -\/O3\ -\/fPIC\ -\/dynamiclib\ \(\backslash\)}
\DoxyCodeLine{\ \ Look\_Back.cpp\ Date\_Dealing.cpp\ LookBackDll.cpp\ \(\backslash\)}
\DoxyCodeLine{\ \ -\/Xpreprocessor\ -\/fopenmp\ \(\backslash\)}
\DoxyCodeLine{\ \ -\/I"{}\$(brew\ -\/-\/prefix\ libomp)/include"{}\ \(\backslash\)}
\DoxyCodeLine{\ \ -\/L"{}\$(brew\ -\/-\/prefix\ libomp)/lib"{}\ \(\backslash\)}
\DoxyCodeLine{\ \ -\/Wl,-\/rpath,"{}\$(brew\ -\/-\/prefix\ libomp)/lib"{}\ \(\backslash\)}
\DoxyCodeLine{\ \ -\/lomp\ \(\backslash\)}
\DoxyCodeLine{\ \ -\/Wl,-\/install\_name,@rpath/libLookBack.dylib\ \(\backslash\)}
\DoxyCodeLine{\ \ -\/o\ libLookBack.dylib}

\end{DoxyCode}
\hypertarget{md__b_u_i_l_d_i_n_g_autotoc_md7}{}\doxysubsection{\texorpdfstring{Notes}{Notes}}\label{md__b_u_i_l_d_i_n_g_autotoc_md7}

\begin{DoxyItemize}
\item -\/Xpreprocessor -\/fopenmp enables Open\+MP for clang.
\item -\/I and -\/L point to Homebrew’s Open\+MP headers and libraries.
\item -\/Wl,-\/rpath,... embeds the runtime search path for libomp.
\item -\/Wl,-\/install\+\_\+name,@rpath/\+lib\+Look\+Back.dylib sets the dynamic loader install name.
\end{DoxyItemize}\hypertarget{md__b_u_i_l_d_i_n_g_autotoc_md8}{}\doxysection{\texorpdfstring{3. Excel Sandbox Installation (Manual)}{3. Excel Sandbox Installation (Manual)}}\label{md__b_u_i_l_d_i_n_g_autotoc_md8}
Microsoft Excel on mac\+OS runs sandboxed. The library must be placed inside Excel’s container:\+


\begin{DoxyCode}{0}
\DoxyCodeLine{\string~/Library/Containers/com.microsoft.Excel/Data/}

\end{DoxyCode}


Open the folder with:\+


\begin{DoxyCode}{0}
\DoxyCodeLine{open\ \string~/Library/Containers/com.microsoft.Excel/Data/}

\end{DoxyCode}


Copy the library:\+


\begin{DoxyCode}{0}
\DoxyCodeLine{cp\ libLookBack.dylib\ \string~/Library/Containers/com.microsoft.Excel/Data/}

\end{DoxyCode}
\hypertarget{md__b_u_i_l_d_i_n_g_autotoc_md9}{}\doxysection{\texorpdfstring{ 4. Open\+MP Runtime Fix (Critical)}{ 4. Open\+MP Runtime Fix (Critical)}}\label{md__b_u_i_l_d_i_n_g_autotoc_md9}
Excel cannot reliably resolve Homebrew paths at runtime. To make the library self-\/contained, libomp.\+dylib must be copied next to lib\+Look\+Back.\+dylib and the dependency rewritten to use @loader\+\_\+path.\hypertarget{md__b_u_i_l_d_i_n_g_autotoc_md10}{}\doxysubsection{\texorpdfstring{Step 1:\+ Copy Open\+Mp runtime}{Step 1:\+ Copy Open\+Mp runtime}}\label{md__b_u_i_l_d_i_n_g_autotoc_md10}

\begin{DoxyCode}{0}
\DoxyCodeLine{cp\ "{}\$(brew\ -\/-\/prefix\ libomp)/lib/libomp.dylib"{}\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \string~/Library/Containers/com.microsoft.Excel/Data/}

\end{DoxyCode}
\hypertarget{md__b_u_i_l_d_i_n_g_autotoc_md11}{}\doxysubsection{\texorpdfstring{Step 2:\+ Rewrite dependency}{Step 2:\+ Rewrite dependency}}\label{md__b_u_i_l_d_i_n_g_autotoc_md11}

\begin{DoxyCode}{0}
\DoxyCodeLine{install\_name\_tool\ -\/change\ \(\backslash\)}
\DoxyCodeLine{\ \ /opt/homebrew/opt/libomp/lib/libomp.dylib\ \(\backslash\)}
\DoxyCodeLine{\ \ @loader\_path/libomp.dylib\ \(\backslash\)}
\DoxyCodeLine{\ \ \string~/Library/Containers/com.microsoft.Excel/Data/libLookBack.dylib}

\end{DoxyCode}


(For Intel Macs, also try /\+usr/\+local/\+opt/\+libomp/\+lib/\+libomp.dylib.)\hypertarget{md__b_u_i_l_d_i_n_g_autotoc_md12}{}\doxysubsection{\texorpdfstring{Step 3:\+ Verify}{Step 3:\+ Verify}}\label{md__b_u_i_l_d_i_n_g_autotoc_md12}

\begin{DoxyCode}{0}
\DoxyCodeLine{otool\ -\/L\ \string~/Library/Containers/com.microsoft.Excel/Data/libLookBack.dylib}

\end{DoxyCode}


Expected output must include:\+

@loader\+\_\+path/\+libomp.dylib 